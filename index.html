<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üíç D√©fi d'amour</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(135deg, #ffdde1, #ee9ca7);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      position: relative;
    }

    .container {
      width: 95%;
      max-width: 600px;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0px 10px 40px rgba(0, 0, 0, 0.2);
      text-align: center;
      position: relative;
      z-index: 5;
    }

    h1 { font-size: 2rem; margin-bottom: 10px; color: #d52f2b; }
    p { font-size: 1rem; color: #333; margin-bottom: 20px; }

    .image-box {
      width: 100%;
      max-height: 60vh;
      border-radius: 18px;
      overflow: hidden;
      margin: 20px 0;
      border: 4px solid #d52f2b;
    }
    .image-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* Timer */
    .timer-container {
      width: 100%;
      height: 10px;
      background: #ddd;
      border-radius: 5px;
      margin: 10px 0;
      overflow: hidden;
    }
    .timer-bar {
      height: 100%;
      width: 100%;
      background: #d52f2b;
      border-radius: 5px;
      transition: width 0.1s linear;
    }

    /* Boutons */
    .buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      position: relative;
      min-height: 200px; /* plus grand pour accueillir plusieurs boutons */
    }

    button {
      border: none;
      padding: 12px 20px;
      border-radius: 14px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s ease;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }

    .btn-yes {
      background: #28a745;
      color: white;
    }
    .btn-yes:hover { transform: scale(1.08); background: #1e7e34; }

    .btn-no {
      background: #dc3545;
      color: white;
    }
    .btn-no:hover { background: #b02a37; }

    /* Boutons en position absolue pour la fuite */
    .btn-absolute {
      position: absolute;
    }

    /* Bouton final g√©ant */
    .btn-giant {
      transform: scale(1.5);
      margin: 20px auto;
      padding: 20px 40px;
      font-size: 1.5rem;
    }

    .secret-box {
      display: none;
      margin-top: 20px;
      padding: 20px;
      border-radius: 15px;
      background: rgba(255, 0, 100, 0.1);
      border: 2px dashed #d52f2b;
      animation: pop 0.4s ease;
    }
    .secret-box h2 { color: #d52f2b; margin: 0 0 10px; }
    .secret-box p { font-size: 1rem; color: #111; margin: 0; }

    @keyframes pop {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* C≈ìurs flottants */
    .heart {
      position: absolute;
      font-size: 22px;
      animation: float 4s infinite ease-in-out;
      opacity: 0.7;
      pointer-events: none;
      z-index: 2;
    }
    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
      100% { transform: translateY(0); }
    }

    /* Modal personnalis√© */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(5px);
      align-items: center;
      justify-content: center;
      z-index: 2000;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; } to { opacity: 1; }
    }
    .modal-content {
      background: white;
      padding: 30px 40px;
      border-radius: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 90%;
      animation: modalPop 0.4s ease;
    }
    @keyframes modalPop {
      0% { transform: scale(0.5); opacity: 0; }
      80% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    .modal-emoji {
      font-size: 6rem;
      line-height: 1;
      margin-bottom: 10px;
    }
    .modal-message {
      font-size: 1.5rem;
      font-weight: 600;
      color: #d52f2b;
    }
    .modal-close {
      margin-top: 20px;
      font-size: 1rem;
      color: #888;
      cursor: pointer;
    }
    .modal-close:hover {
      text-decoration: underline;
    }

    /* Contr√¥le musique */
    .music-control {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      border-radius: 30px;
      padding: 8px 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 100;
      cursor: pointer;
      font-size: 0.9rem;
    }

    /* Confettis */
    @keyframes fall {
      0% { transform: translateY(0); }
      100% { transform: translateY(110vh); }
    }

    @media (max-width: 500px) {
      h1 { font-size: 1.5rem; }
      p, .secret-box p { font-size: 0.9rem; }
      button { font-size: 0.9rem; padding: 10px 18px; }
      .btn-giant { transform: scale(1.2); padding: 15px 30px; }
      .image-box { max-height: 40vh; }
      .modal-emoji { font-size: 4rem; }
      .modal-message { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <!-- √âl√©ments flottants -->
  <div class="heart" style="top: 10%; left: 20%;">‚ù§Ô∏è</div>
  <div class="heart" style="top: 20%; left: 80%;">üíç</div>
  <div class="heart" style="top: 70%; left: 10%;">üíñ</div>
  <div class="heart" style="top: 80%; left: 85%;">üíï</div>

  <!-- Contr√¥le musique -->
  <div class="music-control" id="musicToggle">üîá Activer musique</div>

  <div class="container">
    <h1>Mon amour... üíï</h1>
    <p>J‚Äôai quelques questions pour toi üò≥</p>

    <div class="image-box" id="mainImage">
      <img src="image1.jpeg" alt="Souhayla & Ahmed" />
    </div>

    <!-- Timer -->
    <div class="timer-container">
      <div class="timer-bar" id="timerBar"></div>
    </div>

    <div id="questionBox">
      <p id="questionText" style="font-weight:600;"></p>
      <div class="buttons" id="buttonsContainer"></div>
    </div>

    <div class="secret-box" id="secretBox">
      <h2>üéâ YESSSSS !!!</h2>
      <p>
        7abibiii, tu viens de rendre ma vie compl√®te ‚ù§Ô∏è<br><br>
        enti la7keya elkoll üò≠üíç‚ú®<br><br>
        <b> ŸÜÿ≠ÿ®ŸÉ Ahmed ‚ù§Ô∏è</b>
      </p>
    </div>
  </div>

  <!-- Modal personnalis√© -->
  <div class="modal-overlay" id="customModal">
    <div class="modal-content">
      <div class="modal-emoji" id="modalEmoji">üò†üòò</div>
      <div class="modal-message" id="modalMessage">Tu dois cocher Oui !</div>
      <div class="modal-close" onclick="closeModal()">Fermer</div>
    </div>
  </div>

  <!-- Audio (remplacez les sources par vos fichiers) -->
  <audio id="bgMusic" loop>
    <source src="musique_fond.mp3" type="audio/mpeg">
  </audio>
  <audio id="victoryMusic">
    <source src="victoire.mp3" type="audio/mpeg">
  </audio>

  <script>
    (function() {
      // ---------- Configuration ----------
      const questions = [
        "T7ebbni ? üòò",
        "Bech tdallani ? üíï",
        "Mouch bech t5allini wa7di ? üíñ",
        "Me tor9odech w t5allini nasher wa7di ? üò≠",
        "Veux-tu m'√©pouser ? üíç"   // derni√®re question
      ];
      const LAST_INDEX = questions.length - 1;
      const TIME_PER_QUESTION = 10; // secondes
      const FAKE_YES_THRESHOLD = 3;  // nombre de clics sur faux Oui avant d'afficher le gros bouton

      // ---------- √âl√©ments DOM ----------
      const questionText = document.getElementById('questionText');
      const secretBox = document.getElementById('secretBox');
      const questionBox = document.getElementById('questionBox');
      const mainImage = document.getElementById('mainImage');
      const buttonsContainer = document.getElementById('buttonsContainer');
      const timerBar = document.getElementById('timerBar');
      const modal = document.getElementById('customModal');
      const modalEmoji = document.getElementById('modalEmoji');
      const modalMessage = document.getElementById('modalMessage');
      const musicToggle = document.getElementById('musicToggle');
      const bgMusic = document.getElementById('bgMusic');
      const victoryMusic = document.getElementById('victoryMusic');

      // ---------- Variables d'√©tat ----------
      let currentQuestion = 0;
      let fleeClickCount = 0;          // clics sur le vrai bouton Non (derni√®re question)
      const FLEE_THRESHOLD = 5;        // apr√®s 5 clics, on passe aux Oui multiples
      let fakeYesClickCount = 0;        // clics sur les faux Oui
      let timerInterval = null;
      let timeLeft = TIME_PER_QUESTION;
      let musicEnabled = false;

      // R√©f√©rences aux boutons dynamiques
      let realNoButton = null;          // le vrai bouton Non (celui qui r√©tr√©cit)
      let fakeNoButtons = [];            // les faux boutons Non
      let realYesButton = null;          // le vrai bouton Oui final
      let fakeYesButtons = [];            // les faux boutons Oui finaux

      // ---------- Initialisation ----------
      questionText.innerText = questions[currentQuestion];
      renderNormalButtons();  // affiche les boutons Oui/Non normaux

      // ---------- Fonctions timer ----------
      function startTimer() {
        stopTimer();
        timeLeft = TIME_PER_QUESTION;
        timerBar.style.width = '100%';
        timerInterval = setInterval(() => {
          timeLeft -= 0.1;
          const percent = (timeLeft / TIME_PER_QUESTION) * 100;
          timerBar.style.width = Math.max(0, percent) + '%';
          if (timeLeft <= 0) {
            handleTimeout();
          }
        }, 100);
      }

      function stopTimer() {
        if (timerInterval) clearInterval(timerInterval);
      }

      function handleTimeout() {
        stopTimer();
        showModal('‚è∞üò†', 'Trop tard ! R√©essaie vite üòò');
        startTimer(); // on red√©marre le timer (p√©nalit√© : perte de temps)
      }

      // ---------- Modal ----------
      function showModal(emoji, message, duration = 1500) {
        modalEmoji.innerText = emoji;
        modalMessage.innerText = message;
        modal.style.display = 'flex';
        setTimeout(closeModal, duration);
      }
      window.closeModal = function() { modal.style.display = 'none'; };
      modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

      // ---------- Musique ----------
      musicToggle.addEventListener('click', () => {
        if (musicEnabled) {
          bgMusic.pause();
          musicToggle.innerText = 'üîá Activer musique';
        } else {
          bgMusic.play().catch(e => console.log('Autoplay bloqu√©'));
          musicToggle.innerText = 'üîä Musique active';
        }
        musicEnabled = !musicEnabled;
      });

      // ---------- Rendu des boutons pour questions normales ----------
      function renderNormalButtons() {
        buttonsContainer.innerHTML = ''; // nettoie
        // Cr√©e le bouton Oui
        const yesBtn = document.createElement('button');
        yesBtn.id = 'yesBtn'; // pour compatibilit√© avec les √©v√©nements
        yesBtn.className = 'btn-yes';
        yesBtn.innerText = 'Oui üòç';
        yesBtn.addEventListener('click', onYesClick);
        buttonsContainer.appendChild(yesBtn);

        // Cr√©e le bouton Non (normal, non fuyant)
        const noBtn = document.createElement('button');
        noBtn.id = 'noBtn';
        noBtn.className = 'btn-no normal-mode';
        noBtn.innerText = 'Non üôÑ';
        noBtn.addEventListener('click', onNoClickNormal);
        buttonsContainer.appendChild(noBtn);

        // D√©marrer le timer
        startTimer();
      }

      // ---------- Gestionnaires pour questions normales ----------
      function onYesClick() {
        if (currentQuestion < LAST_INDEX) {
          // Passer √† la question suivante
          currentQuestion++;
          questionText.innerText = questions[currentQuestion];
          stopTimer();
          if (currentQuestion === LAST_INDEX) {
            renderLastQuestion(); // affiche la derni√®re question avec multiples Non
          } else {
            renderNormalButtons();
          }
        }
      }

      function onNoClickNormal(e) {
        e.preventDefault();
        showModal('üò†üòò', 'Tu dois cocher Oui !');
        // Pas de changement de question, le timer continue
      }

      // ---------- Rendu de la derni√®re question (avec multiples Non) ----------
      function renderLastQuestion() {
        buttonsContainer.innerHTML = '';
        stopTimer();
        startTimer(); // red√©marre le timer pour cette question

        // Cr√©er le vrai bouton Non (celui qui r√©tr√©cit)
        realNoButton = document.createElement('button');
        realNoButton.className = 'btn-no btn-absolute';
        realNoButton.innerText = 'Non üôÑ';
        realNoButton.dataset.role = 'real';
        realNoButton.style.transform = 'scale(1)';
        realNoButton.addEventListener('click', onRealNoClick);
        buttonsContainer.appendChild(realNoButton);

        // Cr√©er deux faux boutons Non
        fakeNoButtons = [];
        for (let i = 0; i < 2; i++) {
          const fake = document.createElement('button');
          fake.className = 'btn-no btn-absolute';
          fake.innerText = 'Non üôÑ';
          fake.dataset.role = 'fake';
          fake.addEventListener('click', onFakeNoClick);
          buttonsContainer.appendChild(fake);
          fakeNoButtons.push(fake);
        }

        // Positionner al√©atoirement tous les boutons Non
        positionAllNoButtons();
      }

      function positionAllNoButtons() {
        const containerRect = buttonsContainer.getBoundingClientRect();
        const margin = 15;
        const buttons = [realNoButton, ...fakeNoButtons].filter(b => b !== null);
        buttons.forEach(btn => {
          if (!btn) return;
          const btnRect = btn.getBoundingClientRect();
          let maxX = containerRect.width - btnRect.width - margin;
          let maxY = containerRect.height - btnRect.height - margin;
          let minX = margin;
          let minY = margin;
          if (maxX < minX) { minX = 5; maxX = containerRect.width - btnRect.width - 5; }
          if (maxY < minY) { minY = 5; maxY = containerRect.height - btnRect.height - 5; }
          if (maxX <= 0 || maxY <= 0) return;
          const x = Math.floor(Math.random() * (maxX - minX + 1)) + minX;
          const y = Math.floor(Math.random() * (maxY - minY + 1)) + minY;
          btn.style.left = x + 'px';
          btn.style.top = y + 'px';
        });
      }

      function onRealNoClick(e) {
        e.preventDefault();
        // Incr√©mente le compteur et r√©tr√©cit
        fleeClickCount++;
        const scale = 1 - (fleeClickCount * 0.1); // 0.9, 0.8, ...
        realNoButton.style.transform = `scale(${Math.max(0.5, scale)})`;

        if (fleeClickCount >= FLEE_THRESHOLD) {
          // Fin de la phase Non, on passe aux Oui multiples
          renderFinalYesButtons();
        } else {
          // D√©place tous les boutons (fuite g√©n√©rale)
          positionAllNoButtons();
        }
      }

      function onFakeNoClick(e) {
        e.preventDefault();
        showModal('üòµ', 'Mauvais bouton ! 3le 5atri zid 7awel lin tel9a el Oui');
        // D√©place seulement ce faux bouton
        const fake = e.currentTarget;
        const containerRect = buttonsContainer.getBoundingClientRect();
        const btnRect = fake.getBoundingClientRect();
        const margin = 15;
        let maxX = containerRect.width - btnRect.width - margin;
        let maxY = containerRect.height - btnRect.height - margin;
        let minX = margin;
        let minY = margin;
        if (maxX < minX) { minX = 5; maxX = containerRect.width - btnRect.width - 5; }
        if (maxY < minY) { minY = 5; maxY = containerRect.height - btnRect.height - 5; }
        if (maxX <= 0 || maxY <= 0) return;
        const x = Math.floor(Math.random() * (maxX - minX + 1)) + minX;
        const y = Math.floor(Math.random() * (maxY - minY + 1)) + minY;
        fake.style.left = x + 'px';
        fake.style.top = y + 'px';
      }

      // ---------- Rendu des boutons Oui multiples (final) ----------
      function renderFinalYesButtons() {
        buttonsContainer.innerHTML = '';
        stopTimer();
        // Cacher le timer (plus besoin)
        document.querySelector('.timer-container').style.display = 'none';
        fakeYesClickCount = 0; // r√©initialiser le compteur

        // Cr√©er le vrai bouton Oui (en relatif pour qu'il soit plus facile)
        realYesButton = document.createElement('button');
        realYesButton.className = 'btn-yes';
        realYesButton.innerText = 'Oui üòç';
        realYesButton.dataset.role = 'real';
        realYesButton.style.position = 'relative';
        realYesButton.style.left = 'auto';
        realYesButton.style.top = 'auto';
        realYesButton.style.margin = '0 auto';
        realYesButton.addEventListener('click', triggerFinal);
        buttonsContainer.appendChild(realYesButton);

        // Cr√©er deux faux boutons Oui (en absolu)
        fakeYesButtons = [];
        for (let i = 0; i < 2; i++) {
          const fake = document.createElement('button');
          fake.className = 'btn-yes btn-absolute';
          fake.innerText = 'Oui üòç';
          fake.dataset.role = 'fake';
          fake.addEventListener('click', onFakeYesClick);
          buttonsContainer.appendChild(fake);
          fakeYesButtons.push(fake);
        }

        // Positionner les faux al√©atoirement
        positionFakeYesButtons();
      }

      function positionFakeYesButtons() {
        const containerRect = buttonsContainer.getBoundingClientRect();
        const margin = 15;
        fakeYesButtons.forEach(fake => {
          if (!fake) return;
          const btnRect = fake.getBoundingClientRect();
          let maxX = containerRect.width - btnRect.width - margin;
          let maxY = containerRect.height - btnRect.height - margin;
          let minX = margin;
          let minY = margin;
          if (maxX < minX) { minX = 5; maxX = containerRect.width - btnRect.width - 5; }
          if (maxY < minY) { minY = 5; maxY = containerRect.height - btnRect.height - 5; }
          if (maxX <= 0 || maxY <= 0) return;
          const x = Math.floor(Math.random() * (maxX - minX + 1)) + minX;
          const y = Math.floor(Math.random() * (maxY - minY + 1)) + minY;
          fake.style.left = x + 'px';
          fake.style.top = y + 'px';
        });
      }

      function onFakeYesClick(e) {
        e.preventDefault();
        fakeYesClickCount++;
        // Afficher le message "7awel marra o5ra"
        showModal('ü§î', '7awel marra o5ra', 1200);
        // Le faux Oui fuit
        const fake = e.currentTarget;
        const containerRect = buttonsContainer.getBoundingClientRect();
        const btnRect = fake.getBoundingClientRect();
        const margin = 15;
        let maxX = containerRect.width - btnRect.width - margin;
        let maxY = containerRect.height - btnRect.height - margin;
        let minX = margin;
        let minY = margin;
        if (maxX < minX) { minX = 5; maxX = containerRect.width - btnRect.width - 5; }
        if (maxY < minY) { minY = 5; maxY = containerRect.height - btnRect.height - 5; }
        if (maxX <= 0 || maxY <= 0) return;
        const x = Math.floor(Math.random() * (maxX - minX + 1)) + minX;
        const y = Math.floor(Math.random() * (maxY - minY + 1)) + minY;
        fake.style.left = x + 'px';
        fake.style.top = y + 'px';

        // Si on a atteint le seuil de clics sur faux, on affiche le gros bouton unique
        if (fakeYesClickCount >= FAKE_YES_THRESHOLD) {
          renderFinalSingleYesButton();
        }
      }

      // ---------- Rendu du bouton Oui unique et g√©ant ----------
      function renderFinalSingleYesButton() {
        buttonsContainer.innerHTML = '';
        const giantYes = document.createElement('button');
        giantYes.className = 'btn-yes btn-giant';
        giantYes.innerText = 'OUI üíç';
        giantYes.style.margin = '20px auto';
        giantYes.style.display = 'block';
        giantYes.addEventListener('click', triggerFinal);
        buttonsContainer.appendChild(giantYes);
      }

      // ---------- D√©clenchement final (victoire) ----------
      function triggerFinal() {
        // Jouer musique de victoire
        if (musicEnabled) {
          bgMusic.pause();
          victoryMusic.play().catch(e => console.log('Victoire bloqu√©e'));
        }
        // Cacher la bo√Æte de questions
        questionBox.style.display = 'none';
        secretBox.style.display = 'block';
        mainImage.innerHTML = '<img src="robe_blanc.jpeg" alt="Notre mariage" />';

        // Confettis
        for (let i = 0; i < 30; i++) {
          let emoji = document.createElement('div');
          const randomEmoji = ['üíñ', 'üíç', 'üéâ', 'üíï', 'üòò', 'üíí'][Math.floor(Math.random() * 6)];
          emoji.innerText = randomEmoji;
          emoji.style.position = 'fixed';
          emoji.style.left = Math.random() * 100 + 'vw';
          emoji.style.top = '-20px';
          emoji.style.fontSize = '24px';
          emoji.style.animation = 'fall 3s linear';
          emoji.style.pointerEvents = 'none';
          emoji.style.zIndex = '9999';
          document.body.appendChild(emoji);
          setTimeout(() => emoji.remove(), 3000);
        }
        document.querySelector('h1').innerText = 'üíç F√©licitations mon futur Mari ! üíç';
      }

      // ---------- Gestion redimensionnement pour garder les boutons dans le champ ----------
      window.addEventListener('resize', () => {
        if (currentQuestion === LAST_INDEX && realNoButton && fakeNoButtons.length) {
          positionAllNoButtons();
        } else if (fakeYesButtons.length) {
          positionFakeYesButtons();
        }
      });

      // ---------- Initialisation suppl√©mentaire ----------
      // Animation de chute si non pr√©sente
      if (!document.querySelector('#fallKeyframes')) {
        const style = document.createElement('style');
        style.id = 'fallKeyframes';
        style.innerHTML = `@keyframes fall { 0% { transform: translateY(0); } 100% { transform: translateY(110vh); } }`;
        document.head.appendChild(style);
      }
    })();
  </script>
</body>
</html>